# ダークモード機能の修復タスク

## 問題の概要
- **報告された問題**: 以前はPCやブラウザの設定に合わせてライトモード/ダークモードが適用されていたが、現在は常にライトモードになる
- **期待される動作**: システム設定（prefers-color-scheme）に応じた自動的なテーマ切り替え
- **現在の状況**: 常にライトモードで表示

## 調査段階
- ✅ 現在のダークモード実装方法の確認
- ✅ Tailwind CSS設定の確認 → **設定ファイルなし**
- ✅ テーマ切り替えライブラリの有無確認 → **なし**
- ✅ CSS変数やメディアクエリの確認 → **CSS変数は設定済み、メディアクエリは部分的**
- ✅ 原因の特定と修復方針の決定

## 問題の根本原因
1. **Tailwind設定ファイル不足**: tailwind.config.js/tsがない
2. **HTMLダークモード対応不足**: `<html>`要素の`dark`クラス制御なし
3. **システム設定検出なし**: `prefers-color-scheme`の検出と適用ロジックなし

## 修復方針
1. Tailwind設定ファイル作成（ダークモード設定含む）
2. システム設定検出スクリプト追加
3. HTMLレイアウトの修正

## 修復段階
- ✅ Tailwind設定ファイル作成（ダークモード設定含む）
- ✅ システム設定検出スクリプト追加（ThemeProvider）
- ✅ HTMLレイアウトの修正（ThemeProvider統合）
- ✅ CSS変数形式をhsl形式に統一
- [ ] 動作テスト（人間による確認待ち）

## 実装完了 - テスト待ち状態
全ての修復作業が完了しました。以下を確認してください：

1. **システム設定の反映**: OS/ブラウザのダークモード設定を変更
2. **自動切り替え**: ページが自動的にダーク/ライトテーマに変更されるか
3. **リアルタイム対応**: システム設定を変更した瞬間に反映されるか

## 新しいタスク: Firebase環境変数設定
- ✅ 開発環境用 .env.local ファイル作成
- [ ] 本番環境用シークレット設定（推奨）
- [ ] コードでの使用方法確認

## Chat API修正タスク
- ✅ Vercel AI SDK形式への修正完了
- ✅ streamText と tool の実装
- ✅ R2D2システムプロンプト統合
- ✅ 音声生成ツールの連携

## Firebase推奨設定方法（APIキー用）

確認後、次の質問（Firebase環境変数）にお答えします。

## 新しい緊急課題: 本番環境API問題

**問題**: Firebase Hosting本番環境でAPI Routes（/api/r2d2-chat）が動作せずHTMLが返される
**エラー**: `Stream ended with an incomplete line: "<!DOCTYPE html>..."`
**原因**: Firebase HostingはStatic Hostingのため、Next.js API Routesが動作しない

## 解決オプション
1. **Firebase Functions**: API Routes をFunctions に移行
2. **Vercel移行**: Next.js完全サポートのプラットフォーム
3. **静的版**: チャット機能を表示のみに変更
4. **ローカル確認**: まず開発環境での動作確認

## 次のステップ
- ローカル環境でのテスト
- 本番環境対応方針の決定

## タスク開始
まず現在の実装状況を調査します。 